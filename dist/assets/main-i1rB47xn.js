import{r as a,j as e,C as B,F as $,E as V,U as z,S as y,a as Y,D as q,T as G,b as J,c as W,d as _,e as H,f as K,g as Q,R as X,h as Z}from"./index-BY4fKxQh.js";function ee({isOpen:c,onClose:g,onNext:p}){const[d,j]=a.useState(null),o=a.useRef(null),h=n=>{n.target.files&&n.target.files[0]&&j(n.target.files[0])},i=()=>{o.current.click()};return c?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-8 max-w-lg w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Upload Deal Proposal"}),e.jsx("button",{onClick:g,className:"text-gray-400 hover:text-gray-600",children:e.jsx(B,{})})]}),e.jsx("input",{type:"file",ref:o,onChange:h,className:"hidden",accept:".xlsx, .xls"}),e.jsxs("div",{onClick:i,className:"border-2 border-dashed border-gray-300 rounded-lg p-10 text-center mb-6 cursor-pointer",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx($,{})}),e.jsx("p",{className:"text-gray-600",children:"Click to upload or drag and drop"}),d&&e.jsx("p",{className:"text-sm text-green-600 mt-2 font-semibold",children:d.name}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Excel files only (.xlsx, .xls)"})]}),e.jsxs("div",{className:"flex justify-end space-x-4 mb-6",children:[e.jsx("button",{onClick:g,className:"px-6 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:()=>p(d),disabled:!d,className:"px-6 py-2 text-sm font-medium text-white bg-gray-800 rounded-lg hover:bg-gray-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:"Next"})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Upload Instructions:"}),e.jsxs("ol",{className:"list-decimal list-inside text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"Ensure your Excel file follows the approved template"}),e.jsx("li",{children:"All required fields must be filled out"}),e.jsx("li",{children:"You'll review the data before final submission"}),e.jsx("li",{children:"You'll receive an email once reviewed"})]})]})]})}):null}function se(){const[c,g]=a.useState([]),[p,d]=a.useState(""),[j,o]=a.useState(!1),[h,i]=a.useState(!1),[n,N]=a.useState(null),b=a.useRef(null),[M,v]=a.useState(!1),[w,k]=a.useState(null),[C,r]=a.useState(null),[u,P]=a.useState(1),[S,F]=a.useState(1),[D,I]=a.useState(!0),R=async()=>{I(!0),r(null);try{const t=await(await fetch(`/api/transactions?page=${u}&per_page=30`)).json();if(t.success){const x=t.data.transactions.map(l=>({id:l.id,client:l.clientName,salesman:l.salesman,grossMarginRatio:l.grossMarginRatio,payback:l.payback,submissionDate:new Date(l.submissionDate).toISOString().split("T")[0],approvalDate:l.approvalDate?new Date(l.approvalDate).toISOString().split("T")[0]:"N/A",status:l.ApprovalStatus}));g(x),F(t.data.pages)}else r(t.error||"Failed to fetch transactions.")}catch{r("Failed to connect to the server. Please ensure the backend is running.")}I(!1)};a.useEffect(()=>{R()},[u]);const f=a.useMemo(()=>{const s=c.filter(m=>m.status==="PENDING").length,t=c.reduce((m,L)=>m+(L.totalValue||0),0);return{pendingApprovals:s,totalValue:`$${(t/1e6).toFixed(2)}M`,avgIRR:`${24.5}%`,avgPayback:"20 mo"}},[c]),T=a.useMemo(()=>c.filter(s=>{const t=s.client.toLowerCase().includes(p.toLowerCase());if(!n)return t;const x=new Date(s.submissionDate+"T00:00:00");return t&&x.toDateString()===n.toDateString()}),[c,p,n]);a.useEffect(()=>{function s(t){b.current&&!b.current.contains(t.target)&&i(!1)}return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[b]);const E=()=>{N(null),i(!1)},A=()=>{N(new Date),i(!1)},O=async s=>{if(!s)return;r(null);const t=new FormData;t.append("file",s);try{const l=await(await fetch("/api/process-excel",{method:"POST",body:t})).json();if(l.success){const m={...l.data,fileName:s.name};k(m),o(!1),v(!0)}else r(l.error||"An unknown error occurred."),o(!1)}catch{r("Failed to connect to the server. Please ensure the backend is running."),o(!1)}},U=async()=>{if(w){r(null);try{const t=await(await fetch("/api/submit-transaction",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)})).json();t.success?(R(),v(!1),k(null)):r(t.error||"An unknown error occurred.")}catch{r("Failed to connect to the server. Please ensure the backend is running.")}}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 font-sans text-gray-900",children:[e.jsxs("div",{className:"container mx-auto p-8",children:[e.jsxs("header",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Deal Approval Portal"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Submit and track your deal proposals"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50",children:[e.jsx(V,{}),e.jsx("span",{children:"Export"})]}),e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-black rounded-lg shadow-sm hover:bg-gray-800",children:[e.jsx(z,{}),e.jsx("span",{children:"Upload File"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(y,{title:"Pending Approvals",value:f.pendingApprovals,icon:e.jsx(Y,{}),iconBgColor:"bg-yellow-100"}),e.jsx(y,{title:"Total Value",value:f.totalValue,icon:e.jsx(q,{}),iconBgColor:"bg-green-100"}),e.jsx(y,{title:"Avg IRR",value:f.avgIRR,icon:e.jsx(G,{}),iconBgColor:"bg-blue-100"}),e.jsx(y,{title:"Avg Payback",value:f.avgPayback,icon:e.jsx(J,{}),iconBgColor:"bg-purple-100"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"relative w-full max-w-xs",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(W,{})}),e.jsx("input",{type:"text",placeholder:"Filter by client name...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:p,onChange:s=>d(s.target.value)})]}),e.jsxs("div",{className:"relative w-full max-w-xs",ref:b,children:[e.jsxs("button",{onClick:()=>i(!h),className:"w-full flex justify-between items-center text-left px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("span",{className:n?"text-gray-800":"text-gray-400",children:n?n.toLocaleDateString("en-CA"):"dd/mm/yyyy"}),e.jsx(_,{})]}),h&&e.jsx(H,{selectedDate:n,onSelectDate:s=>{N(s),i(!1)},onClear:E,onSelectToday:A})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-gray-500",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Transaction ID"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Client"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Salesman"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Margin %"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Payback (Months)"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Submission Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Approval Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Status"})]})}),e.jsx("tbody",{children:D?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center py-4",children:"Loading transactions..."})}):T.map(s=>e.jsxs("tr",{className:"bg-white border-b hover:bg-gray-50 cursor-pointer",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900",children:s.id}),e.jsx("td",{className:"px-6 py-4 font-bold text-gray-900",children:s.client}),e.jsx("td",{className:"px-6 py-4",children:s.salesman}),e.jsx("td",{className:"px-6 py-4 font-medium text-blue-600",children:`${(s.grossMarginRatio*100).toFixed(2)}%`}),e.jsx("td",{className:"px-6 py-4",children:s.payback}),e.jsx("td",{className:"px-6 py-4",children:s.submissionDate}),e.jsx("td",{className:"px-6 py-4",children:s.approvalDate}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(K,{status:s.status})})]},s.id))})]})}),e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[e.jsx("button",{onClick:()=>P(s=>Math.max(s-1,1)),disabled:u===1||D,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50 disabled:opacity-50",children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",u," of ",S]}),e.jsx("button",{onClick:()=>P(s=>Math.min(s+1,S)),disabled:u===S||D,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50 disabled:opacity-50",children:"Next"})]})]})]}),C&&e.jsxs("div",{className:"fixed top-5 right-5 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded shadow-lg z-50",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Error: "}),e.jsx("span",{className:"block sm:inline",children:C})]}),e.jsx(ee,{isOpen:j,onClose:()=>o(!1),onNext:O}),e.jsx(Q,{isOpen:M,onClose:()=>v(!1),onConfirm:U,data:w})]})}X.createRoot(document.getElementById("root")).render(e.jsx(Z.StrictMode,{children:e.jsx(se,{})}));
