import{r as a,j as e,S as g,D as V,T as z,a as U,b as Y,c as H,d as _,e as q,f as G,g as J,R as K,h as Q}from"./index-DEC8zjOJ.js";function W(){const[o,R]=a.useState([]),[m,k]=a.useState(""),[N,p]=a.useState(!1),[l,j]=a.useState(null),u=a.useRef(null),[v,i]=a.useState(null),[T,F]=a.useState(null),[P,y]=a.useState(!1),[x,w]=a.useState(1),[b,I]=a.useState(1),[f,D]=a.useState(!0),S=async()=>{D(!0),i(null);try{const s=await(await fetch(`/api/transactions?page=${x}&per_page=30`)).json();if(s.success){const c=s.data.transactions.map(n=>({id:n.id,unidadNegocio:n.unidadNegocio,clientName:n.clientName,salesman:n.salesman,MRC:n.MRC,plazoContrato:n.plazoContrato,grossMarginRatio:n.grossMarginRatio,payback:n.payback,submissionDate:new Date(n.submissionDate).toISOString().split("T")[0],status:n.ApprovalStatus}));R(c),I(s.data.pages)}else i(s.error||"Failed to fetch transactions.")}catch{i("Failed to connect to the server. Please ensure the backend is running.")}D(!1)};a.useEffect(()=>{S()},[x]);const h=a.useMemo(()=>{const t=o.filter(r=>r.status==="APPROVED").reduce((r,d)=>r+(d.totalValue||1e5),0),s=o.length>0?o.reduce((r,d)=>r+d.grossMarginRatio,0)/o.length:0,c=o.filter(r=>r.payback>36).length,n=o.filter(r=>{const d=new Date(r.submissionDate),M=new Date;return d.getMonth()===M.getMonth()&&d.getFullYear()===M.getFullYear()}).length;return{totalApprovedValue:`$${(t/1e6).toFixed(2)}M`,averageMargin:`${(s*100).toFixed(2)}%`,highRiskDeals:c,dealsThisMonth:n}},[o]),A=a.useMemo(()=>o.filter(t=>{const s=t.clientName.toLowerCase().includes(m.toLowerCase());if(!l)return s;const c=new Date(t.submissionDate+"T00:00:00");return s&&c.toDateString()===l.toDateString()}),[o,m,l]);a.useEffect(()=>{function t(s){u.current&&!u.current.contains(s.target)&&p(!1)}return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[u]);const E=()=>{j(null),p(!1)},O=()=>{j(new Date),p(!1)},$=async t=>{try{const c=await(await fetch(`/api/transaction/${t.id}`)).json();c.success?(F(c.data),y(!0)):i(c.error||"Failed to fetch transaction details.")}catch{i("Failed to connect to the server.")}},C=async(t,s)=>{const c=s==="approve"?"approve":"reject";try{const r=await(await fetch(`/api/transaction/${c}/${t}`,{method:"POST"})).json();r.success?(y(!1),S()):i(r.error||`Failed to ${s} transaction.`)}catch{i("Failed to connect to the server.")}},L=t=>{C(t,"approve")},B=t=>{C(t,"reject")};return e.jsxs("div",{className:"min-h-screen bg-gray-50 font-sans text-gray-900",children:[e.jsxs("div",{className:"container mx-auto p-8",children:[e.jsx("header",{className:"flex justify-between items-center mb-8",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Finance Dashboard"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Review and analyze deal proposals"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(g,{title:"Total Approved Value",value:h.totalApprovedValue,icon:e.jsx(V,{}),iconBgColor:"bg-green-100"}),e.jsx(g,{title:"Average Margin",value:h.averageMargin,icon:e.jsx(z,{}),iconBgColor:"bg-blue-100"}),e.jsx(g,{title:"High-Risk Deals",value:h.highRiskDeals,icon:e.jsx(U,{}),iconBgColor:"bg-yellow-100"}),e.jsx(g,{title:"Deals This Month",value:h.dealsThisMonth,icon:e.jsx(Y,{}),iconBgColor:"bg-purple-100"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"relative w-full max-w-xs",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(H,{})}),e.jsx("input",{type:"text",placeholder:"Filter by client name...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:m,onChange:t=>k(t.target.value)})]}),e.jsxs("div",{className:"relative w-full max-w-xs",ref:u,children:[e.jsxs("button",{onClick:()=>p(!N),className:"w-full flex justify-between items-center text-left px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("span",{className:l?"text-gray-800":"text-gray-400",children:l?l.toLocaleDateString("en-CA"):"dd/mm/yyyy"}),e.jsx(_,{})]}),N&&e.jsx(q,{selectedDate:l,onSelectDate:t=>{j(t),p(!1)},onClear:E,onSelectToday:O})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-gray-500",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-center",children:"Transaction ID"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center",children:"Business Unit"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center",children:"Client"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center",children:"Salesman"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center",children:"MRC"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center",children:"Contract Term"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center",children:"Margin %"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center",children:"Payback (Months)"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center",children:"Submission Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center",children:"Status"})]})}),e.jsx("tbody",{children:f?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center py-4",children:"Loading transactions..."})}):A.map(t=>e.jsxs("tr",{className:"bg-white border-b hover:bg-gray-50 cursor-pointer",onClick:()=>$(t),children:[e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900 text-center",children:t.id}),e.jsx("td",{className:"px-6 py-4 text-center",children:t.unidadNegocio}),e.jsx("td",{className:"px-6 py-4 font-bold text-gray-900 text-center",children:t.clientName}),e.jsx("td",{className:"px-6 py-4 text-center",children:t.salesman}),e.jsxs("td",{className:"px-6 py-4 text-center",children:["$",t.MRC.toLocaleString()]}),e.jsx("td",{className:"px-6 py-4 text-center",children:t.plazoContrato}),e.jsx("td",{className:"px-6 py-4 font-medium text-blue-600 text-center",children:`${(t.grossMarginRatio*100).toFixed(2)}%`}),e.jsx("td",{className:"px-6 py-4 text-center",children:t.payback}),e.jsx("td",{className:"px-6 py-4 text-center",children:t.submissionDate}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(G,{status:t.status})})]},t.id))})]})}),e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[e.jsx("button",{onClick:()=>w(t=>Math.max(t-1,1)),disabled:x===1||f,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50 disabled:opacity-50",children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",x," of ",b]}),e.jsx("button",{onClick:()=>w(t=>Math.min(t+1,b)),disabled:x===b||f,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50 disabled:opacity-50",children:"Next"})]})]})]}),v&&e.jsxs("div",{className:"fixed top-5 right-5 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded shadow-lg z-50",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Error: "}),e.jsx("span",{className:"block sm:inline",children:v})]}),e.jsx(J,{isOpen:P,onClose:()=>y(!1),data:T,isFinanceView:!0,onApprove:L,onReject:B})]})}K.createRoot(document.getElementById("root")).render(e.jsx(Q.StrictMode,{children:e.jsx(W,{})}));
